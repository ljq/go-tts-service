<!doctype html>
<html>
    <head>
        <title>
            TTS-API Demo ï¼ˆBy Jack liuï¼ˆJianqiu Liuï¼‰, Link:
            https://github.com/ljqï¼‰
        </title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link
            rel="icon"
            href="https://tts-api.wdft.com/img/favicon.ico"
            type="image/x-icon"
        />
        <style>
            body {
                font-family: Arial, sans-serif;
                text-align: center;
                margin-top: 50px;
            }

            h1 {
                color: #333;
            }

            .box {
                width: 90%;
                display: inline-block;
                margin-top: 20px;
                border: 1px solid #ccc;
                padding: 10px;
                border-radius: 10px;
                margin: 0 autoï¼›;
            }

            form {
                margin-bottom: 20px;
            }
            #ttsForm label {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
            }

            #ttsForm label span {
                margin-right: 10px;
                width: 100px;
            }
            label {
                font-weight: bold;
            }

            textarea {
                width: 90%;
            }

            input {
                width: 15%;
            }

            select {
                min-width: 70px;
            }

            button {
                padding: 10px 20px;
                background-color: #3498db;
                color: #fff;
                border: none;
                cursor: pointer;
                border-radius: 10px;
            }

            audio {
                display: block;
                margin-top: 10px;
            }

            #audioContainer {
                margin-left: 20px;
                border-radius: 10px;
                border: 1px solid #ccc;
                padding: 5px 20px;
            }

            .info {
                color: #3498db;
                margin: 15% auto;
            }

            #audio-download {
                text-decoration: none;
                color: green;
                font-size: 14px;
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <h4>
            æ–‡æœ¬è½¬è‡ªç„¶è¯­éŸ³APIæ¥å£ TTSæµ‹è¯•Demoï¼ˆBy Jack Liu (WebChat: labsec)
            <a href="https://github.com/ljq">https://github.com/ljq</a>ï¼‰
        </h4>
        <h6 style="color: tomato">
            æ³¨æ„äº‹é¡¹ï¼š(1)æ–‡ä»¶åªä½œä¸´æ—¶çŸ­å­˜ï¼Œè¶…æ—¶è‡ªåŠ¨æ¸…ç†ï¼›(2)é’ˆå¯¹å¤§é‡æ–‡æœ¬å†…å®¹è¾“å…¥(åŸºæœ¬æ— å­—ç¬¦é™åˆ¶)ï¼ŒæœåŠ¡å™¨è·¨åœ°åŒºå“åº”è¾ƒæ…¢ï¼Œå¯å¤šæ¬¡å°è¯•ï¼›(3)APIæ¥å£è°ƒç”¨æºç åç»­å¼€æºã€‚
        </h6>
        <div class="box">
            <form id="ttsForm">
                <label for="text">
                    <span>æ–‡æœ¬(Text)ï¼š</span>
                    <textarea
                        id="text"
                        name="text"
                        placeholder="åœ¨è¿™é‡Œè¾“å…¥æ‚¨è¦è½¬æ¢æˆè¯­éŸ³çš„æ–‡æœ¬ï¼ˆIf you have any questions, contact Jack Liu, ljq@GitHubï¼‰"
                        rows="5"
                    >
æ‚¨å¥½ï¼Œæˆ‘çš„ä¸»äººæ˜¯Jack Liuï¼Œä¸­æ–‡åå­—ï¼šåˆ˜å»ºç§‹ï¼Œä½¿ç”¨æœ‰é—®é¢˜è¯·éšæ—¶åé¦ˆï¼Œæˆ–è€…é€šè¿‡ä¸»äººçš„å¼€å‘è€…è´¦å· github.com/ljq è”ç³»ã€‚</textarea
                    >
                </label>
                <label for="role">
                    <span>è§’è‰²(Role)ï¼š</span>
                    <select id="role" name="role" size="14">
                        <option value="zh-CN-YunxiNeural" selected>äº‘æ›¦</option>
                        <option value="zh-CN-XiaoyiNeural">æ™“ä¼Š</option>
                        <option value="zh-CN-XiaoxiaoNeural">ç­±ç­±</option>
                        <option value="zh-CN-YunjianNeural">äº‘é—´</option>
                        <option value="zh-CN-YunxiaNeural">äº‘éœ</option>
                        <option value="zh-CN-YunyangNeural">äº‘æ‰¬</option>
                        <option value="zh-CN-liaoning-XiaobeiNeural">
                            è¾½å®-æ™“è´
                        </option>
                        <option value="zh-CN-shaanxi-XiaoniNeural">
                            é™•è¥¿-æ™“å¦®
                        </option>
                        <option value="zh-HK-HiuGaaiNeural">é¦™æ¸¯-æ™“ä½³</option>
                        <option value="zh-HK-HiuMaanNeural">é¦™æ¸¯-æ™“æ›¼</option>
                        <option value="zh-HK-WanLungNeural">é¦™æ¸¯-äº‘é¾™</option>
                        <option value="zh-TW-HsiaoChenNeural">å°æ¹¾-æ™“æ™¨</option>
                        <option value="zh-TW-HsiaoYuNeural">å°æ¹¾-æ™“ç‘œ</option>
                        <option value="zh-TW-YunJheNeural">å°æ¹¾-äº‘å“²</option>
                    </select>
                    <div
                        style="width: 30%; min-height: 198px; margin-left: 15%"
                    >
                        <div class="info" id="audioInfo"></div>
                        <div id="audioContainer" style="display: none">
                            <h5 style="color: green">ä¸´æ—¶æ–‡ä»¶è½¬æ¢å·²å®Œæˆ âœ…</h5>
                            <h6 style="color: #666666; font-size: 8px">
                                è¯·å°½å¿«è¯•å¬å’Œä¸‹è½½ï¼Œè¶…æ—¶è‡ªåŠ¨æ¸…ç†
                            </h6>
                            <div>
                                <audio
                                    id="audio"
                                    style="margin: 0 auto"
                                    controls
                                ></audio>
                            </div>
                            <div
                                style="margin: 10px auto; color: #3498db"
                                id="download-btn"
                            ></div>
                        </div>
                    </div>
                </label>
                <label for="rate">
                    <span>è¯­é€Ÿè°ƒæ•´ï¼š</span>
                    <select id="rate" name="rate">
                        <option value="+0%" selected>æ ‡å‡†</option>
                        <option value="+10%">+ 10%</option>
                        <option value="+20%">+ 20%</option>
                        <option value="+30%">+ 30%</option>
                        <option value="+40%">+ 40%</option>
                        <option value="+50%">+ 50%</option>
                        <option value="-50%">- 50%</option>
                        <option value="-40%">- 40%</option>
                        <option value="-30%">- 30%</option>
                        <option value="-20%">- 20%</option>
                        <option value="-10%">- 10%</option>
                    </select>
                </label>
                <label for="accessToken">
                    <span>AccessTokenï¼š</span>
                    <input
                        id="accessToken"
                        name="accessToken"
                        type="text"
                        value="02bd6f28f95dc84cfbf22e0ce1083f77"
                        placeholder="è¯·è¾“å…¥accessToken"
                    />
                </label>
                <label>
                    <span
                        ><div
                            style="
                                color: #6666;
                                margin: 2px auto;
                                font-size: 8px;
                            "
                        >
                            å£°æ˜ï¼šç¦æ­¢ç”¨äºéæ³•ç”¨é€”ï¼
                        </div></span
                    >
                    <button type="submit">è½¬æ¢</button>
                </label>
            </form>
        </div>

        <script>
            const form = document.getElementById("ttsForm");
            const audioContainer = document.getElementById("audioContainer");
            const audio = document.getElementById("audio");
            const audioInfo = document.getElementById("audioInfo");

            function getDateTime() {
                // åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºå½“å‰æ—¶é—´çš„ Date å¯¹è±¡
                var now = new Date();

                // è·å–å¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’
                var year = now.getFullYear();
                var month = String(now.getMonth() + 1).padStart(2, "0");
                var day = String(now.getDate()).padStart(2, "0");
                var hour = String(now.getHours()).padStart(2, "0");
                var minute = String(now.getMinutes()).padStart(2, "0");
                var second = String(now.getSeconds()).padStart(2, "0");

                // æ ¼å¼åŒ–æ—¥æœŸå’Œæ—¶é—´å­—ç¬¦ä¸²
                var formattedDateTime =
                    year +
                    "-" +
                    month +
                    "-" +
                    day +
                    "-" +
                    hour +
                    minute +
                    second +
                    "-";

                return formattedDateTime;
            }

            function appendLinkAfter(element, linkUrl, linkFileName) {
                // åˆ›å»º <a> æ ‡ç­¾
                const link = document.createElement("a");
                link.href = linkUrl;
                link.download = linkFileName;
                link.style.color = "green";
                link.style.textDecoration = "underline";
                link.style.cursor = "pointer";
                link.style.fontWeight = "bold";
                link.textContent = "ä¸‹è½½æ–‡ä»¶(.mp3)";
                element.innerHTML = "";
                // å°†é“¾æ¥æ’å…¥åˆ° element å…ƒç´ 
                element.appendChild(link, element.nextSibling);
            }

            form.addEventListener("submit", function (event) {
                event.preventDefault();

                const text = document.getElementById("text").value;
                const role = document.getElementById("role").value;
                const rate = document.getElementById("rate").value;
                const accessToken =
                    document.getElementById("accessToken").value;

                const formData = new FormData();
                if (text == "") {
                    alert("è¯·è¾“å…¥è¦è½¬æ¢çš„æ–‡æœ¬ï¼");
                    return false;
                }

                // æ¸…ç©ºtipå’Œaudio
                document.getElementById("audioInfo").innerHTML = "";
                document.getElementById("audioContainer").style.display =
                    "none";

                formData.append("text", text);
                formData.append("access_token", accessToken);
                formData.append("role", role);
                formData.append("rate", rate);

                document.getElementById("audioInfo").innerHTML =
                    "ğŸ”Š è½¬æ¢ä¸­ï¼Œè¯·ç¨å ... ...";

                fetch("https://tts-api.wdft.com/tts", {
                    method: "POST",
                    mode: "cors",
                    headers: {
                        Origin: "localhost",
                    },
                    body: formData,
                })
                    .then((response) => response.json())
                    .then((data) => {
                        const audioUrl = data.audio_url;
                        if (audioUrl) {
                            audio.src = audioUrl;

                            // ç›‘å¬éŸ³é¢‘åŠ è½½å®Œæˆäº‹ä»¶
                            audio.addEventListener("canplaythrough", () => {
                                //console.log('éŸ³é¢‘åŠ è½½å®Œæˆ');
                                document.getElementById("audioInfo").innerHTML =
                                    "";
                                // åœ¨è¿™é‡Œæ‰§è¡ŒåŠ è½½å®Œæˆåçš„æ“ä½œ
                                audioContainer.style.display = "block";
                                audio.play();
                                // ä¸‹è½½é“¾æ¥èµ‹å€¼
                                mediaFileName = getDateTime() + role + ".mp3";
                                downloadBtn =
                                    document.getElementById("download-btn");
                                appendLinkAfter(
                                    downloadBtn,
                                    audioUrl,
                                    mediaFileName,
                                );
                            });

                            // ç›‘å¬éŸ³é¢‘åŠ è½½é”™è¯¯äº‹ä»¶
                            audio.addEventListener("error", (event) => {
                                //console.error('éŸ³é¢‘åŠ è½½å‡ºé”™ï¼Œè¯·é‡æ–°å°è¯•!', event);
                                // åœ¨è¿™é‡Œå¤„ç†åŠ è½½é”™è¯¯çš„æƒ…å†µ
                                document.getElementById("audioInfo").innerHTML =
                                    "è½¬æ¢å¤±è´¥ï¼Œè¯·é‡æ–°å°è¯•ï¼";
                            });
                        }
                    })
                    .catch((error) => {
                        //console.error("è¯·æ±‚å¤±è´¥:", error);
                        document.getElementById("audioInfo").innerHTML =
                            "<span style='color:red;'>ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡æ–°å°è¯•ï¼<br />è¯·æ£€æŸ¥tokenæ˜¯å¦ç»è¿‡æˆæƒï¼</span>";
                    });
            });
        </script>
    </body>
</html>
